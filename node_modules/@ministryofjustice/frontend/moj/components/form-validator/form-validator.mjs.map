{"version":3,"file":"form-validator.mjs","sources":["../../../../src/moj/components/form-validator/form-validator.mjs"],"sourcesContent":["import $ from 'jquery'\n\nimport { addAttributeValue, removeAttributeValue } from '../../helpers.mjs'\n\nexport function FormValidator(form, options) {\n  this.form = form\n  this.errors = []\n  this.validators = []\n  $(this.form).on('submit', $.proxy(this, 'onSubmit'))\n  this.summary =\n    options && options.summary ? $(options.summary) : $('.govuk-error-summary')\n  this.originalTitle = document.title\n}\n\nFormValidator.entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;',\n  '`': '&#x60;',\n  '=': '&#x3D;'\n}\n\nFormValidator.prototype.escapeHtml = function (string) {\n  return String(string).replace(/[&<>\"'`=/]/g, function fromEntityMap(s) {\n    return FormValidator.entityMap[s]\n  })\n}\n\nFormValidator.prototype.resetTitle = function () {\n  document.title = this.originalTitle\n}\n\nFormValidator.prototype.updateTitle = function () {\n  document.title = `${this.errors.length} errors - ${document.title}`\n}\n\nFormValidator.prototype.showSummary = function () {\n  this.summary.html(this.getSummaryHtml())\n  this.summary.removeClass('moj-hidden')\n  this.summary.attr('aria-labelledby', 'errorSummary-heading')\n  this.summary.focus()\n}\n\nFormValidator.prototype.getSummaryHtml = function () {\n  let html =\n    '<h2 id=\"error-summary-title\" class=\"govuk-error-summary__title\">There is a problem</h2>'\n  html += '<div class=\"govuk-error-summary__body\">'\n  html += '<ul class=\"govuk-list govuk-error-summary__list\">'\n  for (let i = 0, j = this.errors.length; i < j; i++) {\n    const error = this.errors[i]\n    html += '<li>'\n    html += `<a href=\"#${this.escapeHtml(error.fieldName)}\">`\n    html += this.escapeHtml(error.message)\n    html += '</a>'\n    html += '</li>'\n  }\n  html += '</ul>'\n  html += '</div>'\n  return html\n}\n\nFormValidator.prototype.hideSummary = function () {\n  this.summary.addClass('moj-hidden')\n  this.summary.removeAttr('aria-labelledby')\n}\n\nFormValidator.prototype.onSubmit = function (e) {\n  this.removeInlineErrors()\n  this.hideSummary()\n  this.resetTitle()\n  if (!this.validate()) {\n    e.preventDefault()\n    this.updateTitle()\n    this.showSummary()\n    this.showInlineErrors()\n  }\n}\n\nFormValidator.prototype.showInlineErrors = function () {\n  for (let i = 0, j = this.errors.length; i < j; i++) {\n    this.showInlineError(this.errors[i])\n  }\n}\n\nFormValidator.prototype.showInlineError = function (error) {\n  const errorSpanId = `${error.fieldName}-error`\n  const errorSpan = `<span class=\"govuk-error-message\" id=\"${\n    errorSpanId\n  }\">${this.escapeHtml(error.message)}</span>`\n  const control = $(`#${error.fieldName}`)\n  const fieldContainer = control.parents('.govuk-form-group')\n  const label = fieldContainer.find('label')\n  const legend = fieldContainer.find('legend')\n  const fieldset = fieldContainer.find('fieldset')\n  fieldContainer.addClass('govuk-form-group--error')\n  if (legend.length) {\n    legend.after(errorSpan)\n    fieldContainer.attr('aria-invalid', 'true')\n    addAttributeValue(fieldset[0], 'aria-describedby', errorSpanId)\n  } else {\n    label.after(errorSpan)\n    control.attr('aria-invalid', 'true')\n    addAttributeValue(control[0], 'aria-describedby', errorSpanId)\n  }\n}\n\nFormValidator.prototype.removeInlineErrors = function () {\n  for (let i = 0; i < this.errors.length; i++) {\n    this.removeInlineError(this.errors[i])\n  }\n}\n\nFormValidator.prototype.removeInlineError = function (error) {\n  const control = $(`#${error.fieldName}`)\n  const fieldContainer = control.parents('.govuk-form-group')\n  fieldContainer.find('.govuk-error-message').remove()\n  fieldContainer.removeClass('govuk-form-group--error')\n  fieldContainer.find('[aria-invalid]').attr('aria-invalid', 'false')\n  const errorSpanId = `${error.fieldName}-error`\n  removeAttributeValue(\n    fieldContainer.find('[aria-describedby]')[0],\n    'aria-describedby',\n    errorSpanId\n  )\n}\n\nFormValidator.prototype.addValidator = function (fieldName, rules) {\n  this.validators.push({\n    fieldName,\n    rules,\n    field: this.form.elements[fieldName]\n  })\n}\n\nFormValidator.prototype.validate = function () {\n  this.errors = []\n  let validator = null\n  let validatorReturnValue = true\n  let i\n  let j\n  for (i = 0; i < this.validators.length; i++) {\n    validator = this.validators[i]\n    for (j = 0; j < validator.rules.length; j++) {\n      validatorReturnValue = validator.rules[j].method(\n        validator.field,\n        validator.rules[j].params\n      )\n\n      if (typeof validatorReturnValue === 'boolean' && !validatorReturnValue) {\n        this.errors.push({\n          fieldName: validator.fieldName,\n          message: validator.rules[j].message\n        })\n        break\n      } else if (typeof validatorReturnValue === 'string') {\n        this.errors.push({\n          fieldName: validatorReturnValue,\n          message: validator.rules[j].message\n        })\n        break\n      }\n    }\n  }\n  return this.errors.length === 0\n}\n"],"names":[],"mappings":"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"}