{"version":3,"file":"add-another.js","sources":["../../../../src/moj/components/add-another/add-another.mjs"],"sourcesContent":["import $ from 'jquery'\n\nexport function AddAnother(container) {\n  this.container = $(container)\n\n  if (this.container.data('moj-add-another-initialised')) {\n    return\n  }\n\n  this.container.data('moj-add-another-initialised', true)\n\n  this.container.on(\n    'click',\n    '.moj-add-another__remove-button',\n    $.proxy(this, 'onRemoveButtonClick')\n  )\n  this.container.on(\n    'click',\n    '.moj-add-another__add-button',\n    $.proxy(this, 'onAddButtonClick')\n  )\n  this.container\n    .find('.moj-add-another__add-button, moj-add-another__remove-button')\n    .prop('type', 'button')\n}\n\nAddAnother.prototype.onAddButtonClick = function (e) {\n  const item = this.getNewItem()\n  this.updateAttributes(this.getItems().length, item)\n  this.resetItem(item)\n  const firstItem = this.getItems().first()\n  if (!this.hasRemoveButton(firstItem)) {\n    this.createRemoveButton(firstItem)\n  }\n  this.getItems().last().after(item)\n  item.find('input, textarea, select').first().focus()\n}\n\nAddAnother.prototype.hasRemoveButton = function (item) {\n  return item.find('.moj-add-another__remove-button').length\n}\n\nAddAnother.prototype.getItems = function () {\n  return this.container.find('.moj-add-another__item')\n}\n\nAddAnother.prototype.getNewItem = function () {\n  const item = this.getItems().first().clone()\n  if (!this.hasRemoveButton(item)) {\n    this.createRemoveButton(item)\n  }\n  return item\n}\n\nAddAnother.prototype.updateAttributes = function (index, item) {\n  item.find('[data-name]').each(function (i, el) {\n    const originalId = el.id\n\n    el.name = $(el)\n      .attr('data-name')\n      .replace(/%index%/, index)\n    el.id = $(el)\n      .attr('data-id')\n      .replace(/%index%/, index)\n\n    const label =\n      $(el).siblings('label')[0] ||\n      $(el).parents('label')[0] ||\n      item.find(`[for=\"${originalId}\"]`)[0]\n    label.htmlFor = el.id\n  })\n}\n\nAddAnother.prototype.createRemoveButton = function (item) {\n  item.append(\n    '<button type=\"button\" class=\"govuk-button govuk-button--secondary moj-add-another__remove-button\">Remove</button>'\n  )\n}\n\nAddAnother.prototype.resetItem = function (item) {\n  item.find('[data-name], [data-id]').each(function (index, el) {\n    if (el.type === 'checkbox' || el.type === 'radio') {\n      el.checked = false\n    } else {\n      el.value = ''\n    }\n  })\n}\n\nAddAnother.prototype.onRemoveButtonClick = function (e) {\n  $(e.currentTarget).parents('.moj-add-another__item').remove()\n  const items = this.getItems()\n  if (items.length === 1) {\n    items.find('.moj-add-another__remove-button').remove()\n  }\n  items.each(\n    $.proxy(function (index, el) {\n      this.updateAttributes(index, $(el))\n    }, this)\n  )\n  this.focusHeading()\n}\n\nAddAnother.prototype.focusHeading = function () {\n  this.container.find('.moj-add-another__heading').get(0).focus()\n}\n"],"names":[],"mappings":"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"}