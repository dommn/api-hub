{"version":3,"file":"add-another.mjs","sources":["../../../../src/moj/components/add-another/add-another.mjs"],"sourcesContent":["import $ from 'jquery'\n\nexport function AddAnother(container) {\n  this.container = $(container)\n\n  if (this.container.data('moj-add-another-initialised')) {\n    return\n  }\n\n  this.container.data('moj-add-another-initialised', true)\n\n  this.container.on(\n    'click',\n    '.moj-add-another__remove-button',\n    $.proxy(this, 'onRemoveButtonClick')\n  )\n  this.container.on(\n    'click',\n    '.moj-add-another__add-button',\n    $.proxy(this, 'onAddButtonClick')\n  )\n  this.container\n    .find('.moj-add-another__add-button, moj-add-another__remove-button')\n    .prop('type', 'button')\n}\n\nAddAnother.prototype.onAddButtonClick = function (e) {\n  const item = this.getNewItem()\n  this.updateAttributes(this.getItems().length, item)\n  this.resetItem(item)\n  const firstItem = this.getItems().first()\n  if (!this.hasRemoveButton(firstItem)) {\n    this.createRemoveButton(firstItem)\n  }\n  this.getItems().last().after(item)\n  item.find('input, textarea, select').first().focus()\n}\n\nAddAnother.prototype.hasRemoveButton = function (item) {\n  return item.find('.moj-add-another__remove-button').length\n}\n\nAddAnother.prototype.getItems = function () {\n  return this.container.find('.moj-add-another__item')\n}\n\nAddAnother.prototype.getNewItem = function () {\n  const item = this.getItems().first().clone()\n  if (!this.hasRemoveButton(item)) {\n    this.createRemoveButton(item)\n  }\n  return item\n}\n\nAddAnother.prototype.updateAttributes = function (index, item) {\n  item.find('[data-name]').each(function (i, el) {\n    const originalId = el.id\n\n    el.name = $(el)\n      .attr('data-name')\n      .replace(/%index%/, index)\n    el.id = $(el)\n      .attr('data-id')\n      .replace(/%index%/, index)\n\n    const label =\n      $(el).siblings('label')[0] ||\n      $(el).parents('label')[0] ||\n      item.find(`[for=\"${originalId}\"]`)[0]\n    label.htmlFor = el.id\n  })\n}\n\nAddAnother.prototype.createRemoveButton = function (item) {\n  item.append(\n    '<button type=\"button\" class=\"govuk-button govuk-button--secondary moj-add-another__remove-button\">Remove</button>'\n  )\n}\n\nAddAnother.prototype.resetItem = function (item) {\n  item.find('[data-name], [data-id]').each(function (index, el) {\n    if (el.type === 'checkbox' || el.type === 'radio') {\n      el.checked = false\n    } else {\n      el.value = ''\n    }\n  })\n}\n\nAddAnother.prototype.onRemoveButtonClick = function (e) {\n  $(e.currentTarget).parents('.moj-add-another__item').remove()\n  const items = this.getItems()\n  if (items.length === 1) {\n    items.find('.moj-add-another__remove-button').remove()\n  }\n  items.each(\n    $.proxy(function (index, el) {\n      this.updateAttributes(index, $(el))\n    }, this)\n  )\n  this.focusHeading()\n}\n\nAddAnother.prototype.focusHeading = function () {\n  this.container.find('.moj-add-another__heading').get(0).focus()\n}\n"],"names":[],"mappings":"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"}