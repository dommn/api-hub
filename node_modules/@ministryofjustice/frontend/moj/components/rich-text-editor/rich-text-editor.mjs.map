{"version":3,"file":"rich-text-editor.mjs","sources":["../../../../src/moj/components/rich-text-editor/rich-text-editor.mjs"],"sourcesContent":["import $ from 'jquery'\n\nexport function RichTextEditor(options) {\n  if (!('contentEditable' in document.documentElement)) {\n    return\n  }\n\n  this.options = options\n  this.options.toolbar = this.options.toolbar || {\n    bold: false,\n    italic: false,\n    underline: false,\n    bullets: true,\n    numbers: true\n  }\n  this.textarea = this.options.textarea\n  this.container = $(this.textarea).parent()\n\n  if (this.container.data('moj-rich-text-editor-initialised')) {\n    return\n  }\n\n  this.container.data('moj-rich-text-editor-initialised', true)\n\n  this.createToolbar()\n  this.hideDefault()\n  this.configureToolbar()\n  this.keys = {\n    left: 37,\n    right: 39,\n    up: 38,\n    down: 40\n  }\n  this.container.on(\n    'click',\n    '.moj-rich-text-editor__toolbar-button',\n    $.proxy(this, 'onButtonClick')\n  )\n  this.container\n    .find('.moj-rich-text-editor__content')\n    .on('input', $.proxy(this, 'onEditorInput'))\n  this.container.find('label').on('click', $.proxy(this, 'onLabelClick'))\n  this.toolbar.on('keydown', $.proxy(this, 'onToolbarKeydown'))\n}\n\nRichTextEditor.prototype.onToolbarKeydown = function (e) {\n  let focusableButton\n  switch (e.keyCode) {\n    case this.keys.right:\n    case this.keys.down: {\n      focusableButton = this.toolbar.find('button[tabindex=0]')\n      const nextButton = focusableButton.next('button')\n      if (nextButton[0]) {\n        nextButton.focus()\n        focusableButton.attr('tabindex', '-1')\n        nextButton.attr('tabindex', '0')\n      }\n      break\n    }\n    case this.keys.left:\n    case this.keys.up: {\n      focusableButton = this.toolbar.find('button[tabindex=0]')\n      const previousButton = focusableButton.prev('button')\n      if (previousButton[0]) {\n        previousButton.focus()\n        focusableButton.attr('tabindex', '-1')\n        previousButton.attr('tabindex', '0')\n      }\n      break\n    }\n  }\n}\n\nRichTextEditor.prototype.getToolbarHtml = function () {\n  let html = ''\n\n  html += '<div class=\"moj-rich-text-editor__toolbar\" role=\"toolbar\">'\n\n  if (this.options.toolbar.bold) {\n    html +=\n      '<button class=\"moj-rich-text-editor__toolbar-button moj-rich-text-editor__toolbar-button--bold\" type=\"button\" data-command=\"bold\"><span class=\"govuk-visually-hidden\">Bold</span></button>'\n  }\n\n  if (this.options.toolbar.italic) {\n    html +=\n      '<button class=\"moj-rich-text-editor__toolbar-button moj-rich-text-editor__toolbar-button--italic\" type=\"button\" data-command=\"italic\"><span class=\"govuk-visually-hidden\">Italic</span></button>'\n  }\n\n  if (this.options.toolbar.underline) {\n    html +=\n      '<button class=\"moj-rich-text-editor__toolbar-button moj-rich-text-editor__toolbar-button--underline\" type=\"button\" data-command=\"underline\"><span class=\"govuk-visually-hidden\">Underline</span></button>'\n  }\n\n  if (this.options.toolbar.bullets) {\n    html +=\n      '<button class=\"moj-rich-text-editor__toolbar-button moj-rich-text-editor__toolbar-button--unordered-list\" type=\"button\" data-command=\"insertUnorderedList\"><span class=\"govuk-visually-hidden\">Unordered list</span></button>'\n  }\n\n  if (this.options.toolbar.numbers) {\n    html +=\n      '<button class=\"moj-rich-text-editor__toolbar-button moj-rich-text-editor__toolbar-button--ordered-list\" type=\"button\" data-command=\"insertOrderedList\"><span class=\"govuk-visually-hidden\">Ordered list</span></button>'\n  }\n\n  html += '</div>'\n  return html\n}\n\nRichTextEditor.prototype.getEnhancedHtml = function (val) {\n  return `${this.getToolbarHtml()}<div class=\"govuk-textarea moj-rich-text-editor__content\" contenteditable=\"true\" spellcheck=\"false\"></div>`\n}\n\nRichTextEditor.prototype.hideDefault = function () {\n  this.textarea = this.container.find('textarea')\n  this.textarea.addClass('govuk-visually-hidden')\n  this.textarea.attr('aria-hidden', true)\n  this.textarea.attr('tabindex', '-1')\n}\n\nRichTextEditor.prototype.createToolbar = function () {\n  this.toolbar = document.createElement('div')\n  this.toolbar.className = 'moj-rich-text-editor'\n  this.toolbar.innerHTML = this.getEnhancedHtml()\n  this.container.append(this.toolbar)\n  this.toolbar = this.container.find('.moj-rich-text-editor__toolbar')\n  this.container\n    .find('.moj-rich-text-editor__content')\n    .html(this.textarea.val())\n}\n\nRichTextEditor.prototype.configureToolbar = function () {\n  this.buttons = this.container.find('.moj-rich-text-editor__toolbar-button')\n  this.buttons.prop('tabindex', '-1')\n  const firstTab = this.buttons.first()\n  firstTab.prop('tabindex', '0')\n}\n\nRichTextEditor.prototype.onButtonClick = function (e) {\n  document.execCommand($(e.currentTarget).data('command'), false, null)\n}\n\nRichTextEditor.prototype.getContent = function () {\n  return this.container.find('.moj-rich-text-editor__content').html()\n}\n\nRichTextEditor.prototype.onEditorInput = function (e) {\n  this.updateTextarea()\n}\n\nRichTextEditor.prototype.updateTextarea = function () {\n  document.execCommand('defaultParagraphSeparator', false, 'p')\n  this.textarea.val(this.getContent())\n}\n\nRichTextEditor.prototype.onLabelClick = function (e) {\n  e.preventDefault()\n  this.container.find('.moj-rich-text-editor__content').focus()\n}\n"],"names":[],"mappings":"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"}